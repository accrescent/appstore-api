// Copyright 2025 Logan Magee
//
// SPDX-License-Identifier: MPL-2.0

syntax = "proto3";

package accrescent.directory.v1;

import "accrescent/directory/v1/device_attributes.proto";
import "buf/validate/validate.proto";

option java_multiple_files = true;
option java_package = "app.accrescent.directory.v1";

// Request defining parameters to retrieving an app's update info.
message GetAppUpdateInfoRequest {
  // The application ID of the update info to retrieve.
  optional string app_id = 1 [
    (buf.validate.field).required = true,
    // According to
    // https://developer.android.com/build/configure-app-module#set-application-id,
    // the app ID must conform to the following rules:
    //
    // 1. It must have at least two segments (one or more dots).
    // 2. Each segment must start with a letter.
    // 3. All characters must be alphanumeric or an underscore [a-zA-Z0-9_].
    //
    // The maximum length is imposed by us to set a reasonable limit.
    (buf.validate.field).string = {
      pattern: "^([a-zA-Z][a-zA-Z0-9_]*\\.)+[a-zA-Z][a-zA-Z0-9_]*$"
      max_bytes: 128
    }
  ];

  // The current device's hardware and OS attributes used to determine app
  // compatibility, download size, etc.
  DeviceAttributes device_attributes = 2 [(buf.validate.field).required = true];

  // The base version of the app to get update info from, i.e., the currently
  // installed version.
  optional uint64 base_version_code = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).uint64.gt = 0
  ];
}
